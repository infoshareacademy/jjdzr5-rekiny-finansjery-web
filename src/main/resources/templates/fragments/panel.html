<div th:fragment="admin_panel_modals">
    <!--    <div th:insert="fragments/panel :: add_user_modal"></div>-->
    <div th:each="user : ${userList}">
        <div th:replace="fragments/panel :: admin_user_modals"></div>
    </div>
</div>

<!-- ======= Edit/Delete User ======= -->
<!-- Buttons -->
<div th:fragment="admin_user_buttons" id="admin_user_buttons" class="d-inline">
    <!-- Edit User Button -->
    <button class="btn mx-1 btn-warning"
            th:data-bs-toggle="modal"
            th:data-bs-target="'#editUser_' + ${user.id}" type="button">
        <i class="bi bi-pencil"></i>
    </button>
    <!-- Delete User Button -->
    <button class="btn mx-1 me-3 btn-danger"
            th:data-bs-toggle="modal"
            th:data-bs-target="'#deleteUser_' + ${user.id}" type="button">
        <i class="bi bi-x-lg"></i>
    </button>
</div>

<!-- Modals -->
<div th:fragment="admin_user_modals" id="admin_user_modals" class="d-inline">

    <div class="modal fade py-5" tabindex="-1" role="dialog"
         th:id="'editUser_' + ${user.id}">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pb-4 pt-0 text-center">
                    <!-- Edit User -->
                    <div class="d-flex justify-content-between align-items-center px-5">
                        <i class="bi bi-pencil-square text-warning" style="font-size: 85px"></i>
                        <h2 th:text="#{edit.user}" class="fw-bold mb-0">Edit User</h2>
                    </div>
                    <form th:action="@{/admin/edit-user}" th:method="post" th:object="${userAdminPanel}"
                          class="px-5">
                        <input type="hidden" th:value="${user.id}" name="id">
                        <div class="d-flex align-items-center justify-content-end form-check form-switch mb-3">
                            <label class="form-check-label" for="isEnabled"
                                   th:text="#{panel.user.enabled}">Enabled</label>
                            <input type="checkbox" class="form-check-input ms-3 me-1" id="isEnabled"
                                   th:checked="${user.enabled}" name="enabled">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="editEmail" class="col-form-label w-50"
                                   th:text="#{panel.user.email}">Email</label>
                            <input type="text" class="form-control rounded-4" id="editEmail"
                                   th:value="${user.email}" name="email" required>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="editName" class="col-form-label w-50"
                                   th:text="#{panel.user.name}">Name</label>
                            <input type="text" class="form-control rounded-4" id="editName"
                                   th:value="${user.name}" name="name" required maxlength="30">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="editLastName" class="col-form-label w-50"
                                   th:text="#{panel.user.lastname}">Last Name</label>
                            <input type="text" class="form-control rounded-4" id="editLastName"
                                   th:value="${user.lastname}" name="lastname" required maxlength="30">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="editBillingCurrency" class="col-form-label w-50"
                                   th:text="#{panel.user.billing.currency}">Billing Currency</label>
                            <input type="number" class="form-control rounded-4" id="editBillingCurrency"
                                   th:value="${user.billingCurrency}" step="any" name="billingCurrency" required>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="userRoles" class="w-50"
                                   th:text="#{panel.user.role}">User Roles</label>
                            <div id="userRoles" class="w-100 pt-2">
                                <div th:each="userEnum : ${T(org.infoshare.rekinyfinansjeryweb.entity.user.UserEnum).values()}"
                                     class="form-check form-check-inline">
                                    <label class="form-check-label text-start"
                                           th:for="'checkbox' + ${userEnum}"></label>
                                    <input class="form-check-input" type="checkbox" th:id="'checkbox' + ${userEnum}"
                                           th:with="userRole=${userEnum}" th:value="${userEnum}" th:checked="${user.getRole().contains(userRole)}"
                                           th:text="#{${userEnum.roleName}}" name="role">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer d-flex pb-0 align-items-center justify-content-center">
                            <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 150px"
                                    type="button"
                                    th:text="#{cancel.button}" data-bs-dismiss="modal"> Cancel
                            </button>
                            <button class="btn btn-lg my-2 mx-1 rounded-4 btn-warning" style="width: 150px"
                                    type="submit"
                                    th:text="#{save.button}"> Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal modal-alert fade py-5" tabindex="-1" role="dialog"
         th:id="'deleteUser_' + ${user.id}">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!-- Delete User -->
                <div class="modal-body pb-5 pt-0 text-center">
                    <i class="bi bi-x-circle text-danger" style="font-size: 85px"></i>
                    <h3 th:text="${user.email}" class="mt-3">User Email</h3>
                    <h5 class="mb-0 mt-4" th:text="#{delete.user}">Do you want to delete this user?</h5>
                    <p class="mb-0" th:text="#{delete.warning}">This action cannot be reversed.</p>
                </div>
                <div class="modal-footer d-flex p-3 align-items-center justify-content-center">
                    <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 150px" type="button"
                            th:text="#{cancel.button}" data-bs-dismiss="modal"> Cancel
                    </button>
                    <form th:action="@{/admin/delete-user}" th:method="post" th:object="${user}">
                        <input type="hidden" th:value="${user.email}" name="email">
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-danger" style="width: 150px" type="submit"
                                th:text="#{delete.button}"> Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>