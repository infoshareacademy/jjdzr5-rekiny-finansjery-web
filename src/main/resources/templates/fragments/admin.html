<div th:fragment="tables_admin_modals">
    <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')" th:insert="fragments/admin :: add_currency_main_modal"></div>
    <div th:each="exchangeRates : ${pageContent}">
        <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')" th:insert="fragments/admin :: edit_table_modal"></div>
        <div th:each="rate : ${exchangeRates.getRates()}">
            <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')"
                 th:replace="fragments/admin :: edit_currency_modal"></div>
        </div>
        <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')" th:insert="fragments/admin :: add_currency_modal"></div>
    </div>
</div>

<div th:fragment="table_admin_modals">
    <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')" th:insert="fragments/admin :: edit_table_modal"></div>
    <div th:each="rate : ${exchangeRates.getRates()}">
        <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')" th:replace="fragments/admin :: edit_currency_modal"></div>
    </div>
    <div sec:authorize="hasAnyAuthority('ROLE_ADMIN')" th:insert="fragments/admin :: add_currency_modal"></div>
</div>

<!-- ======= Add New Currency ======= -->
<div th:fragment="add_currency_main_button" id="add_currency_main" class="text-end pe-3">
    <button class="btn my-2 mx-1 rounded-4 btn-primary" style="width: 150px"
            th:data-bs-toggle="modal"
            th:data-bs-target="'#add_currency_main_modal'" type="button">
        <i class="bi bi-plus-lg"></i> <span th:text="#{new.currency.button}">New Currency</span>
    </button>
</div>
<div th:fragment="add_currency_main_modal" id="add_currency_main_modal_fragment">
    <div class="modal fade py-5" tabindex="-1" role="dialog" th:id="add_currency_main_modal">
        <div class="modal-dialog">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pb-4 pt-0 text-center">
                    <!--Add-->
                    <div class="d-flex justify-content-around align-items-center px-4">
                        <i class="bi bi-plus-circle text-primary" style="font-size: 85px"></i>
                        <h2 th:text="#{add.new.currency}" class="fw-bold mb-0">Add New Currency</h2>
                    </div>
                    <form th:action="@{/admin/add-currency}"
                          th:object="${newCurrency}"
                          th:method="post"
                          class="px-5 my-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="rateDate" class="col-form-label w-50"
                                   th:text="#{collection.view.date}">Date</label>
                            <input type="date" class="form-control rounded-4" id="rateDate"
                                   placeholder="Exchange Rate Date" th:field="*{date}"
                                   required
                                   th:min="${#dates.format(#dates.create(2022,1,1), 'yyyy-MM-dd')}"
                                   th:max="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="currencyName" class="col-form-label w-50"
                                   th:text="#{collection.view.currency.name}">Currency Name</label>
                            <input type="text" class="form-control rounded-4" id="currencyName"
                                   th:field="*{currency}" required maxlength="20">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="code" class="col-form-label w-50" th:text="#{collection.view.code}">Code</label>
                            <input type="text" class="form-control rounded-4" id="code"
                                   th:field="*{code}" required maxlength="3">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="category" class="col-form-label w-50" th:text="#{collection.view.category}">Category</label>
                            <input type="text" class="form-control rounded-4" id="category"
                                   th:field="*{category}" required maxlength="20">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="bid" class="col-form-label w-50" th:text="#{collection.view.bid}">Bid</label>
                            <input type="number" class="form-control rounded-4" id="bid"
                                   value="0" step="any" th:field="*{bid}" required max="100">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="ask" class="col-form-label w-50" th:text="#{collection.view.ask}">Ask</label>
                            <input type="number" class="form-control rounded-4" id="ask"
                                   value="0" step="any" th:field="*{ask}" required max="100">
                        </div>
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 170px" type="button"
                                th:text="#{cancel.button}" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-primary" style="width: 170px" type="submit"
                                th:text="#{add.button}">
                            Add Currency
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ======= Edit/Delete Table ======= -->
<div th:fragment="edit_table_buttons" id="edit_table">
    <div class="text-end">
        <!-- Delete Table -->
        <button th:with="date=${exchangeRates.getDate()}" class="btn my-2 mx-1 rounded-4 btn-danger" style="width: 120px"
                th:data-bs-toggle="modal"
                th:data-bs-target="'#delete' + ${#strings.replace(date,'/','_')}">
            <i class="bi bi-x-lg"></i> <span th:text="#{delete.button}">Delete Table</span>
        </button>
    </div>
</div>
<div th:fragment="edit_table_modal" id="edit_table_modal_fragment">
    <div th:with="date=${exchangeRates.getDate()}" class="modal modal-alert fade py-5" tabindex="-1" role="dialog"
         th:id="'delete' + ${#strings.replace(date,'/','_')}">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!--Delete-->
                <div class="modal-body pb-5 pt-0 text-center">
                    <i class="bi bi-x-circle text-primary" style="font-size: 85px"></i>
                    <h3 th:text="${exchangeRates.getDate()}" class="mt-3">Table Date</h3>
                    <h5 class="mb-0 mt-4" th:text="#{delete.table}">Do you want to delete this table?</h5>
                    <p class="mb-0" th:text="#{delete.warning}">This action cannot be reversed.</p>
                </div>
                <div class="modal-footer d-flex p-3 align-items-center justify-content-center">
                    <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 150px" type="button"
                            th:text="#{cancel.button}" data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <form th:with="date=${exchangeRates.getDate()}"
                          th:action="@{/admin/delete-table/{table}(table=${#strings.replace(date,'/','_')})}"
                          th:method="post">
                        <input type="hidden" th:value="post">
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-danger" style="width: 150px"
                                type="submit" th:text="#{delete.button}">
                            Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ======= Add New Currency ======= -->
<div th:fragment="add_currency_buttons" id="add_currency" class="text-center">
    <button th:with="date=${exchangeRates.getDate()}" class="btn btn-lg mx-1 rounded-4 btn-secondary"
            th:data-bs-toggle="modal"
            th:data-bs-target="'#addCurrency' + ${#strings.replace(date,'/','_')}"><i class="bi bi-plus-lg h4"></i>
    </button>
</div>
<div th:fragment="add_currency_modal" id="add_currency_modal_fragment" class="text-center">
    <div th:with="date=${exchangeRates.getDate()}" class="modal fade py-5" tabindex="-1" role="dialog"
         th:id="'addCurrency' + ${#strings.replace(date,'/','_')}">
        <div class="modal-dialog">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pb-4 pt-0 text-center">
                    <!--Add-->
                    <div class="d-flex justify-content-around align-items-center px-4">
                        <i class="bi bi-plus-circle text-primary" style="font-size: 85px"></i>
                        <h2 cc class="fw-bold mb-0" th:text="#{add.new.currency}">Add New Currency</h2>
                    </div>
                    <form th:with="date=${exchangeRates.getDate()}"
                          th:action="@{/admin/add-currency/{date}(date=${#strings.replace(date,'/','_')})}"
                          th:object="${newCurrency}"
                          th:method="post"
                          class="px-5 my-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="rateDate" class="col-form-label w-50"
                                   th:text="#{collection.view.date}">Date</label>
                            <input type="date" class="form-control rounded-4" id="rateDate"
                                   placeholder="Exchange Rate Date" th:field="*{date}"
                                   required
                                   th:min="${#dates.format(#dates.create(2022,1,1), 'yyyy-MM-dd')}"
                                   th:max="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="currencyName" class="col-form-label w-50"
                                   th:text="#{collection.view.currency.name}">Currency Name</label>
                            <input type="text" class="form-control rounded-4" id="currencyName"
                                   th:field="*{currency}" required maxlength="20">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="code" class="col-form-label w-50" th:text="#{collection.view.code}">Code</label>
                            <input type="text" class="form-control rounded-4" id="code"
                                   th:field="*{code}" required maxlength="3">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="category" class="col-form-label w-50" th:text="#{collection.view.category}">Category</label>
                            <input type="text" class="form-control rounded-4" id="category"
                                   th:field="*{category}" required maxlength="20">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="bid" class="col-form-label w-50" th:text="#{collection.view.bid}">Bid</label>
                            <input type="number" class="form-control rounded-4" id="bid"
                                   value="0" step="any" th:field="*{bid}" required max="100">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="ask" class="col-form-label w-50" th:text="#{collection.view.ask}">Ask</label>
                            <input type="number" class="form-control rounded-4" id="ask"
                                   value="0" step="any" th:field="*{ask}" required max="100">
                        </div>
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 170px" type="button"
                                th:text="#{cancel.button}" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-primary" style="width: 170px" type="submit"
                                th:text="#{add.button}">
                            Add Currency
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ======= Edit/Delete Currency ======= -->
<div th:fragment="edit_currency_buttons" id="edit_currency" class="d-inline">
    <!-- Edit Currency  -->
    <button th:with="date=${exchangeRates.getDate()}, code=${rate.code}" class="btn mx-1 btn-warning"
            th:data-bs-toggle="modal"
            th:data-bs-target="'#editCurrency' + ${#strings.replace(date,'/','_')} + ${code}" type="button">
        <i class="bi bi-pencil"></i>
    </button>
    <!-- Delete Currency  -->
    <button th:with="date=${exchangeRates.getDate()}, code=${rate.code}" class="btn mx-1 me-3 btn-danger"
            th:data-bs-toggle="modal"
            th:data-bs-target="'#deleteCurrency' + ${#strings.replace(date,'/','_')} + ${code}" type="button">
        <i class="bi bi-x-lg"></i>
    </button>
</div>
<div th:fragment="edit_currency_modal" id="edit_currency_modal_fragment" class="d-inline">
    <div th:with="date=${exchangeRates.getDate()}, code=${rate.code}" class="modal fade py-5" tabindex="-1" role="dialog"
         th:id="'editCurrency' + ${#strings.replace(date,'/','_')} + ${code}">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pb-4 pt-0 text-center">
                    <!--Edit-->
                    <div class="d-flex justify-content-between align-items-center px-5">
                        <i class="bi bi-pencil-square text-primary" style="font-size: 85px"></i>
                        <h2 th:text="#{edit.currency} + ' ' + ${exchangeRates.getDate()}" class="fw-bold mb-0">Edit
                            Currency</h2>
                    </div>
                    <form th:with="date=${exchangeRates.getDate()}"
                          th:action="@{/admin/edit-currency/{table}/{code}(table=${#strings.replace(date,'/','_')}, code=${rate.code})}"
                          th:object="${newCurrency}"
                          th:method="post"
                          class="px-5 my-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="rateDate" class="col-form-label w-50"
                                   th:text="#{collection.view.date}">Date</label>
                            <input type="date" class="form-control rounded-4" id="rateDate"
                                   th:value="${exchangeRates.getDate()}" name="date" required
                                   th:min="${#dates.format(#dates.create(2022,1,1), 'yyyy-MM-dd')}"
                                   th:max="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="editCurrencyName" class="col-form-label w-50"
                                   th:text="#{collection.view.currency.name}">Currency Name</label>
                            <input type="text" class="form-control rounded-4" id="editCurrencyName"
                                   th:value="${rate.name}" name="currency" required maxlength="20">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="editCurrencyCode" class="col-form-label w-50"
                                   th:text="#{collection.view.code}">Code</label>
                            <input type="text" class="form-control rounded-4" id="editCurrencyCode"
                                   th:value="${rate.code}" name="code" required maxlength="3">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <label for="category" class="col-form-label w-50" th:text="#{collection.view.category}">Category</label>
                            <input type="text" class="form-control rounded-4" id="category"
                                   th:value="${rate.category}" name="category" required maxlength="20">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="editCurrencyBid" class="col-form-label w-50"
                                   th:text="#{collection.view.bid}">Bid</label>
                            <input type="number" class="form-control rounded-4" id="editCurrencyBid"
                                   th:value="${rate.bidPrice}" step="any" name="bid" required max="100">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <label for="editCurrencyAsk" class="col-form-label w-50"
                                   th:text="#{collection.view.ask}">Ask</label>
                            <input type="number" class="form-control rounded-4" id="editCurrencyAsk"
                                   th:value="${rate.askPrice}" step="any" name="ask" required max="100">
                        </div>
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 150px" type="button"
                                th:text="#{cancel.button}" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-warning" style="width: 150px" type="submit"
                                th:text="#{save.button}">
                            Save
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div th:with="date=${exchangeRates.getDate()}, code=${rate.code}" class="modal modal-alert fade py-5" tabindex="-1"
         role="dialog"
         th:id="'deleteCurrency' + ${#strings.replace(date,'/','_')} + ${code}">
        <div class="modal-dialog" role="document">
            <div class="modal-content rounded-5 shadow">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!--Delete-->
                <div class="modal-body pb-5 pt-0 text-center">
                    <i class="bi bi-x-circle text-primary" style="font-size: 85px"></i>
                    <h3 th:text="${exchangeRates.getDate()}" class="mt-3">Table Date</h3>
                    <h3 th:text="${rate.code}" class="mt-3">Currency</h3>
                    <h5 class="mb-0 mt-4" th:text="#{delete.currency}">Do you want to delete this currency?</h5>
                    <p class="mb-0" th:text="#{delete.warning}">This action cannot be reversed.</p>
                </div>
                <div class="modal-footer d-flex p-3 align-items-center justify-content-center">
                    <button class="btn btn-lg my-2 mx-1 rounded-4 btn-secondary" style="width: 150px" type="button"
                            th:text="#{cancel.button}" data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <form th:with="date=${exchangeRates.getDate()}"
                          th:action="@{/admin/delete-currency/{table}/{code}(table=${#strings.replace(date,'/','_')}, code=${rate.code})}"
                          th:method="post">
                        <input type="hidden" th:value="post">
                        <button class="btn btn-lg my-2 mx-1 rounded-4 btn-danger" style="width: 150px" type="submit"
                                th:text="#{delete.button}">
                            Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>